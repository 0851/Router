(function(e,n){if(typeof define==="function"&&define.amd){define(n)}else if(typeof exports==="object"){module.exports=n()}else{e.Router=n()}})(this,function(){function o(e,n){var t,r;if(this==null){throw new TypeError("this is null or not defined")}var i=Object(e);var a=i.length>>>0;if(typeof n!=="function"){throw new TypeError(n+" is not a function")}if(arguments.length>1){t=arguments[1]}r=0;while(r<a){var o;if(r in i){o=i[r];n.call(t,o,r,i)}r++}}function _(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function i(e,n,t,r){n=n||"&";t=t||"=";var i={};if(typeof e!=="string"||e.length===0){return i}var a=/\+/g;e=e.split(n);var o=1e3;if(r&&typeof r.maxKeys==="number"){o=r.maxKeys}var s=e.length;if(o>0&&s>o){s=o}for(var l=0;l<s;++l){var u=e[l].replace(a,"%20"),f=u.indexOf(t),c,h,p,v;if(f>=0){c=u.substr(0,f);h=u.substr(f+1)}else{c=u;h=""}p=decodeURIComponent(c);v=decodeURIComponent(h);if(!_(i,p)){i[p]=v}else if(Array.isArray(i[p])){i[p].push(v)}else{i[p]=[i[p],v]}}return i}function s(e,n){var t=Object.prototype.toString.call(e);return new RegExp(n,"i").test(t)}function a(e,t){var n=[];var r=this;r.__inner.console.log(e,t,"all listeners");o(e,function(e){if(e.type==="regexp"&&e.path.test(t)===true){n.push(e)}if(e.type==="string"&&e.path===t){n.push(e)}});n.sort(function(e,n){var t=parseInt(e.level)||0;var r=parseInt(n.level)||0;if(t>r){return 1}if(t<r){return-1}return 0});r.__inner.console.log(n,t,"filters listeners");o(n,function(e){if(!s(e.middleware,"function")){return}var n=t.split("?");e.middleware(n[0],n[1]?i(n[1]):{})})}function l(e){if(e.state===null){e.preventDefault();return false}var n=this;var t=window.location;n.__inner.console.log(arguments,"onpopstate",t);var r=n.__inner.listeners;var i=t.pathname;a.call(n,r,i)}function u(e){var n=this;var t=window.location;n.__inner.console.log(arguments,"onhashchange",t);var r=n.__inner.listeners;var i=t.hash.replace(/^#/,"");a.call(n,r,i)}function f(e,n){if(!e){return false}if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey){return false}if(e.defaultPrevented){return false}if(e.button!==undefined&&e.button!==0){return false}var t=e.target||e.srcElement;var r=t.getAttribute("target");var i=t.getAttribute("href");if(!i){return false}if(/^#/.test(i)&&n!==true){return false}if(!/^#/.test(i)&&n===true){return false}if(/_blank/i.test(r)){return false}if(e.preventDefault){e.preventDefault()}return true}function c(e){var n=this;var t=e.target||e.srcElement;var r=t.getAttribute("href");var i=t.getAttribute("replace");if(f(e,n.__inner.isHash)!==true){return}n.go(r,i)}function e(e){e=s(e,"object")?e:{};var n=s(e.dom,"html")?e.dom:document;var t=s(e.hash,"bool")?e.hash:true;var r=s(e.debug,"bool")?e.debug:false;var i=this;var a={warn:function(){i.__inner.isDebugger&&console.warn.apply(null,arguments)},error:function(){i.__inner.isDebugger&&console.error.apply(null,arguments)},info:function(){i.__inner.isDebugger&&console.info.apply(null,arguments)},log:function(){i.__inner.isDebugger&&console.log.apply(null,arguments)}};i.__inner={listeners:[],isDebugger:!!r,isHash:!!t,onPopstate:function(){return l.apply(i,arguments)},onHashchange:function(){return u.apply(i,arguments)},onAttach:function(){return c.apply(i,arguments)},console:a,doms:[n]};i.__inner.console.log("init success")}e.prototype={start:function(){var e=this;e.attach();e.__inner.console.log("attach event success")},use:function(t,r,i){var e=this;var a=-1;o(e.__inner.listeners,function(e,n){if(e.middleware===r&&e.path===t&&e.level===i){a=key}});if(a>=0){return}var n="";if(s(t,"regexp")){n="regexp"}if(s(t,"string")){n="string"}if(n===""){return}e.__inner.listeners.push({path:t,middleware:r,level:i,type:n})},go:function(e,n){var t=this;e=window.encodeURI(e);if(t.__inner.isHash===true){window.location.hash=e;return}var r={key:Date.now(),path:e};var i=new PopStateEvent("popstate",{state:r});if(n===true){window.history.replaceState(r,"",e)}else{window.history.pushState(r,"",e)}dispatchEvent(i)},back:function(){window.history.go(-1)},attach:function(e){var n=this;if(s(e,"html")){n.__inner.doms.push(e)}if(n.__inner.isHash!==true){var t={state:{key:Date.now(),path:window.location.pathname}};n.__inner.onPopstate.call(this,t);window.addEventListener("popstate",n.__inner.onPopstate)}else{n.__inner.onHashchange.call(this);window.addEventListener("hashchange",n.__inner.onHashchange)}o(n.__inner.doms,function(e){e.addEventListener("click",n.__inner.onAttach,false)})},destroy:function(){var n=this;n.__inner.isHash!==true&&window.removeEventListener("popstate",n.__inner.onPopstate);n.__inner.isHash===true&&window.removeEventListener("hashchange",n.__inner.onHashchange);o(n.__inner.doms,function(e){e.removeEventListener("click",n.__inner.onAttach,false)})}};return e});